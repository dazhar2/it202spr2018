<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Potato</title>
  <link rel="canonical" href="https://weather-pwa-sample.firebaseapp.com/final/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://unpkg.com/material-components-web@0.9.1/dist/material-components-web.min.css">
  <link rel="stylesheet" href="styles/weather-icons.min.css">
  <link rel="stylesheet" href="styles/weather.css">
  <link rel="stylesheet" href="styles/inline.css">
  <link rel="stylesheet" href="styles/pagination.css">
  <link href="https://fonts.googleapis.com/css?family=Karla" rel="stylesheet">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://unpkg.com/material-components-web@0.9.1/dist/material-components-web.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.js"></script>
  <script type="text/javascript" src="https://cdn.aerisjs.com/aeris.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="scripts/pagination.js"></script>

  <style type='text/css'>
    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #map {
      height: 100%;
    }

    #mapContainer {
      height: 300px;
      width: 80%;
      margin: 0 auto;
    }


    #map-canvas {
      width: 100%;
      height: 100%;
    }

    #input-fields {
      padding-left: 20px;
    }

    .gm-style-iw {
      text-align: center;
    }

    ul,
    li {
      list-style: none;
    }

    #wrapper {
      width: 900px;
      margin: 20px auto;
    }

    .data-container {
      margin-top: 20px;
    }

    .data-container ul {
      padding: 0;
      margin: 0;
    }

    .data-container li {
      margin-bottom: 5px;
      padding: 5px 10px;
      background: #eee;
      color: #666;
    }

    #page1 {
      width: 100%;
    }

    .news-image {
      position: absolute;
      overflow: auto;
      display: block;
      padding-top: 20px;
    }

    .news-content {
      overflow: auto;
      padding-left: 90px;
      font-family: 'Karla', sans-serif;
      display: block;

    }

    .news-title {
      font-size: 30px;
    }

    .mdc-toolbar__title,
    .mdc-button {
      font-family: 'Karla', sans-serif;
    }

    .mdc-card {
      background-color: white;
      font-family: 'Karla', sans-serif;
    }

    .weatherContainer {
      width: 100px;

    }

    .weatherBox {
      width: 50px;
      height: 50px;
      display: block;
    }

    #weather-icon {
      width: 50px;
    }


    .checkboxSpace {
      margin-right: 500px;
    }


    button {
      background: transparent;
      border: none;
      color: #989898;
      font-size: 30px;
    }

    .weatherIcon,
    .weatherContainer,
    .weatherBox {
      display: inline-block;
    }
  </style>
</head>

<body class="mdc-typography">
  <header id="shrine-header" class="mdc-toolbar mdc-toolbar--fixed mdc-theme--text-primary-on-background">
    <div class="mdc-toolbar__row">
      <section class="mdc-toolbar__section mdc-toolbar__section--align-start">
        <a id="shrine-nav-icon" class="material-icons mdc-ripple-surface" style="color:black" href="#" aria-label="Click to show the navigation menu" aria-controls="shrine-nav-menu" data-mdc-auto-init="MDCRipple" data-mdc-ripple-is-unbounded>menu</a>
        <h1 class="mdc-toolbar__title"><span>Good Morning</span></h1>
      </section>
    </div>
  </header>


  <aside id="shrine-nav-menu" class="mdc-temporary-drawer" data-mdc-auto-init="MDCTemporaryDrawer">
    <nav class="mdc-temporary-drawer__drawer">
      <header class="mdc-temporary-drawer__header"></header>
      <nav class="mdc-temporary-drawer__content mdc-list">
        <a class="mdc-list-item" id="showPage1Btn" data-launch-view="page1">Page 1</a>
        <a class="mdc-list-item" id="showPage2Btn" data-launch-view="page2">Page 2</a>
        <a class="mdc-list-item" id="showPage3Btn" data-launch-view="page3">Page 3</a>
      </nav>
    </nav>
  </aside>
  <div class="view" id="page1">
    <main id="shrine-products" class="mdc-layout-grid mdc-toolbar-fixed-adjust">

      <div id="wrapper">
        <h1> Today's News</h1>

        <section>
          <div class="data-container"></div>
          <div id="pagination-demo2"></div>
        </section>
      </div>
    </main>
  </div>

  <div class="view hide" id="page2">

    <main class="mdc-toolbar-fixed-adjust main">
      <h1> Today's Weather</h1>
      <div class="card cardTemplate weather-forecast" hidden>
        <div class="city-key" hidden></div>
        <div class="card-last-updated" hidden></div>
        <div class="location"></div>
        <div class="date"></div>
        <div class="description"></div>
        <div class="current">
          <div class="visual">
            <div class="icon"></div>
            <div class="temperature">
              <span class="value"></span><span class="scale">°F</span>
            </div>
          </div>
          <div class="description">
            <div class="humidity"></div>
            <div class="wind">
              <span class="value"></span>
              <span class="scale">mph</span>
              <span class="direction"></span>°
            </div>
            <div class="sunrise"></div>
            <div class="sunset"></div>
          </div>
        </div>
        <div class="future">
          <div class="oneday">
            <div class="date"></div>
            <div class="icon"></div>
            <div class="temp-high">
              <span class="value"></span>°
            </div>
            <div class="temp-low">
              <span class="value"></span>°
            </div>
          </div>
          <div class="oneday">
            <div class="date"></div>
            <div class="icon"></div>
            <div class="temp-high">
              <span class="value"></span>°
            </div>
            <div class="temp-low">
              <span class="value"></span>°
            </div>
          </div>
          <div class="oneday">
            <div class="date"></div>
            <div class="icon"></div>
            <div class="temp-high">
              <span class="value"></span>°
            </div>
            <div class="temp-low">
              <span class="value"></span>°
            </div>
          </div>
          <div class="oneday">
            <div class="date"></div>
            <div class="icon"></div>
            <div class="temp-high">
              <span class="value"></span>°
            </div>
            <div class="temp-low">
              <span class="value"></span>°
            </div>
          </div>
          <div class="oneday">
            <div class="date"></div>
            <div class="icon"></div>
            <div class="temp-high">
              <span class="value"></span>°
            </div>
            <div class="temp-low">
              <span class="value"></span>°
            </div>
          </div>
          <div class="oneday">
            <div class="date"></div>
            <div class="icon"></div>
            <div class="temp-high">
              <span class="value"></span>°
            </div>
            <div class="temp-low">
              <span class="value"></span>°
            </div>
          </div>
          <div class="oneday">
            <div class="date"></div>
            <div class="icon"></div>
            <div class="temp-high">
              <span class="value"></span>°
            </div>
            <div class="temp-low">
              <span class="value"></span>°
            </div>
          </div>
        </div>
      </div>



    </main>
    <div id="mapContainer">
      <div id="map-canvas"></div>
    </div>
  </div>

  <div class="view hide" id="page3">
    <main class="main mdc-toolbar-fixed-adjust">
      <h1>Today's To-Do List</h1>
      <section id="input-fields">
        <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--upgraded">
          <h3> Create Task</h3>
          <textarea id="taskField" class="mdc-text-field__input" rows="3" cols="40"></textarea>
        </div>
        <button id="addtask" class="mdc-button">Add task to list</button>
        <h3> Task List</h3>

        <div class="mdc-form-field">
          <table>
            <tbody id="checkboxTable">

            </tbody>


          </table>

        </div>
      </section>

    </main>
  </div>


  <script>
    mdc.autoInit();
    document.getElementById('shrine-nav-icon').addEventListener('click', function(evt) {
      evt.preventDefault();
      document.getElementById('shrine-nav-menu').MDCTemporaryDrawer.open = true;
    });

    $(document).ready(function(e) {
      $("#page2").hide();
      $("#page3").hide();

      function showView(viewName) {
        $('.view').hide();
        $('#' + viewName).show();
      }

      $('[data-launch-view]').click(function(e) {
        e.preventDefault();
        var viewName = $(this).attr('data-launch-view');
        showView(viewName);
      });


      (function(name) {
        var container = $('#pagination-' + name);
        var url = "https://api.nytimes.com/svc/topstories/v2/home.json";
        url += '?' + $.param({
          'api-key': "bb39364e5757463f839f9b6d8bbb5027"
        });

        console.log('#pagination-' + name);
        $('#pagination-' + name).pagination({
          dataSource: function(done) {
            $.ajax({
              type: 'GET',
              url: url,
              dataType: "json",
              success: function(response) {
                console.log(response);
                done(response.results);
              }
            });
          },
          locator: 'results',
          totalNumber: 120,
          pageSize: 10,
          ajax: {
            beforeSend: function() {
              container.prev().html('Loading data ...');
            }
          },
          callback: function(response, pagination) {
            window.console && console.log(22, response, pagination);
            var dataHtml = '';
            $.each(response, function(index, item) {
              if (item.multimedia[0] !== undefined) {
                var multimedia = item.multimedia[0];


                dataHtml += "<div class='mdc-card'>" +
                  "<div class='mdc-card__media mdc-card__media--square'>" +
                  "<div class='mdc-card__media-content'>";

                dataHtml += "<div class='news-image'><img src='" + multimedia.url + "'/></div>";
                dataHtml += "<div  class='news-content'><p class='news-title'>" + item.title + "</p></div><br><div class='news-content'>" + item.byline + '</div>';
                dataHtml += "</div></div>" +
                  "<div class='mdc-card__actions'>" +
                  "<div class='mdc-card__action-buttons'>" +
                  "<a class='mdc-button mdc-card__action mdc-card__action--button news-card' target='_blank' href='" + item.url + "'>Go to Aricle</a>" +
                  "</div>" +
                  "<div class='mdc-card__action-icons'></div>" +
                  "</div>" +
                  "</div>";
              }
            });
            container.prev().html(dataHtml);
          }
        })
      })('demo2');

    })
  </script>

  <script async>
    var app = {
      isLoading: true,
      visibleCards: {},
      selectedCities: [],
      cardTemplate: document.querySelector('.cardTemplate'),
      container: document.querySelector('.main'),
      addDialog: document.querySelector('.dialog-container'),
      daysOfWeek: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
    };

    document.getElementById("showPage2Btn").addEventListener("click", showWeather);

    function showWeather() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      }
      else {}

      function showPosition(position) {
        app.getForecast(position);
        getWeatherMap(position.coords.latitude, position.coords.longitude);
      }

    }

    function getWeatherMap(lat, lng) {
      aeris.config.set({
        apiId: '6pbnOP9CAOsJuPO54Amtc',
        apiSecret: 'Z03Peiy0fqffc1Or4WQq1k17r6QND8C5LqUWvpSy'
      });

      var map = new aeris.maps.Map('map-canvas', {
        zoom: 8,
        center: [lat, lng],
        baseLayer: new aeris.maps.layers.AerisTile({
          tileType: 'flat-dk',
          zIndex: 1
        })
      });

      // Create 'water-depth' layer
      var waterDepth = new aeris.maps.layers.AerisTile({
        tileType: 'water-depth',
        zIndex: 3,
        map: map
      });

      var adminCitiesDk = new aeris.maps.layers.AerisTile({
        tileType: 'admin-cities-dk',
        zIndex: 6,
        map: map
      });

      var satellite = new aeris.maps.layers.AerisTile({
        tileType: 'satellite',
        zIndex: 7,
        map: map
      });

      var radar = new aeris.maps.layers.AerisTile({
        tileType: 'radar',
        zIndex: 9,
        map: map
      });

      var animation = new aeris.maps.animations.AnimationSync([
        satellite,
        radar
      ], {
        from: Date.now() - 1000 * 60 * 60 * 2, // 2 hours ago
        to: Date.now()
      });

      animation.start();
    }

    app.updateForecastCard = function(data) {
      var dataLastUpdated = new Date(data.created);
      var sunrise = data.channel.astronomy.sunrise;
      var sunset = data.channel.astronomy.sunset;
      var current = data.channel.item.condition;
      var humidity = data.channel.atmosphere.humidity;
      var wind = data.channel.wind;

      var card = app.visibleCards[data.key];
      if (!card) {
        card = app.cardTemplate.cloneNode(true);
        card.classList.remove('cardTemplate');
        card.querySelector('.location').textContent = data.label;
        card.removeAttribute('hidden');
        app.container.appendChild(card);
        app.visibleCards[data.key] = card;
      }

      card.querySelector('.description').textContent = current.text;
      card.querySelector('.date').textContent = current.date;
      card.querySelector('.current .icon').classList.add(app.getIconClass(current.code));
      card.querySelector('.current .temperature .value').textContent =
        Math.round(current.temp);
      card.querySelector('.current .sunrise').textContent = sunrise;
      card.querySelector('.current .sunset').textContent = sunset;
      card.querySelector('.current .humidity').textContent =
        Math.round(humidity) + '%';
      card.querySelector('.current .wind .value').textContent =
        Math.round(wind.speed);
      card.querySelector('.current .wind .direction').textContent = wind.direction;
      var nextDays = card.querySelectorAll('.future .oneday');
      var today = new Date();
      today = today.getDay();
      for (var i = 0; i < 7; i++) {
        var nextDay = nextDays[i];
        var daily = data.channel.item.forecast[i];
        if (daily && nextDay) {
          nextDay.querySelector('.date').textContent =
            app.daysOfWeek[(i + today) % 7];
          nextDay.querySelector('.icon').classList.add(app.getIconClass(daily.code));
          nextDay.querySelector('.temp-high .value').textContent =
            Math.round(daily.high);
          nextDay.querySelector('.temp-low .value').textContent =
            Math.round(daily.low);
        }
      }

    };

    app.getForecast = function(position) {
      console.log(position.coords.latitude + "," + position.coords.longitude);

      var url = 'https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22(' +
        position.coords.latitude + '%2C' + position.coords.longitude + ')%22)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys';


      var xhr = new XMLHttpRequest();

      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            var response = JSON.parse(xhr.response);
            var results = response.query.results;
            results.created = response.query.created;
            app.updateForecastCard(results);
          }
        }
        else {}
      };

      xhr.open('GET', url);
      xhr.send();
    };



    app.getIconClass = function(weatherCode) {
      weatherCode = parseInt(weatherCode);
      switch (weatherCode) {
        case 25: // cold
        case 32: // sunny
        case 33: // fair (night)
        case 34: // fair (day)
        case 36: // hot
        case 3200: // not available
          return 'clear-day';
        case 0: // tornado
        case 1: // tropical storm
        case 2: // hurricane
        case 6: // mixed rain and sleet
        case 8: // freezing drizzle
        case 9: // drizzle
        case 10: // freezing rain
        case 11: // showers
        case 12: // showers
        case 17: // hail
        case 35: // mixed rain and hail
        case 40: // scattered showers
          return 'rain';
        case 3: // severe thunderstorms
        case 4: // thunderstorms
        case 37: // isolated thunderstorms
        case 38: // scattered thunderstorms
        case 39: // scattered thunderstorms (not a typo)
        case 45: // thundershowers
        case 47: // isolated thundershowers
          return 'thunderstorms';
        case 5: // mixed rain and snow
        case 7: // mixed snow and sleet
        case 13: // snow flurries
        case 14: // light snow showers
        case 16: // snow
        case 18: // sleet
        case 41: // heavy snow
        case 42: // scattered snow showers
        case 43: // heavy snow
        case 46: // snow showers
          return 'snow';
        case 15: // blowing snow
        case 19: // dust
        case 20: // foggy
        case 21: // haze
        case 22: // smoky
          return 'fog';
        case 24: // windy
        case 23: // blustery
          return 'windy';
        case 26: // cloudy
        case 27: // mostly cloudy (night)
        case 28: // mostly cloudy (day)
        case 31: // clear (night)
          return 'cloudy';
        case 29: // partly cloudy (night)
        case 30: // partly cloudy (day)
        case 44: // partly cloudy
          return 'partly-cloudy-day';
      }
    };
  </script>
  <script>
    document.getElementById("addtask").addEventListener("click", addTask);
    var taskNum = 0;

    function addTask() {
      var task = document.getElementById("taskField").value;
      var taskItem = "<tr><td><div class='mdc-checkbox'>" +
        "<input type='checkbox' class='mdc-checkbox__native-control' id='" + taskNum + "box'/>" +
        "<div class='mdc-checkbox__background'>" +
        "<svg class='mdc-checkbox__checkmark' viewBox='0 0 24 24'>" +
        "<path class='mdc-checkbox__checkmark-path' " +
        "fill='none'" +
        "stroke='white'" +
        "d='M1.73,12.91 8.1,19.28 22.79,4.59'/>" +
        "</svg>" +
        "<div class='mdc-checkbox__mixedmark'></div>" +
        "</div>" +
        "</div>" +
        "<label for='my-checkbox' id='" + taskNum + "label'>" + task + "</label></td></tr>";

      taskNum++;

      $("#checkboxTable").append(taskItem);

      addToDatabase($('#' + (taskNum - 1) + 'label').text());

    }

    var indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB || window.shimIndexedDB;

    function addToDatabase(task) {
      var open = indexedDB.open("MyDatabase", 1);

      // Create the schema
      open.onupgradeneeded = function() {
        var db = open.result;
        var store = db.createObjectStore("MyObjectStore", { keyPath: "id", autoIncrement: true });
        var index = store.createIndex("TaskIndex", "task", { unique: true });
      };

      open.onsuccess = function() {
        // Start a new transaction
        var db = open.result;
        var tx = db.transaction("MyObjectStore", "readwrite");
        var store = tx.objectStore("MyObjectStore");
        var index = store.index("TaskIndex");

        store.add({ task: task });

        tx.oncomplete = function() {
          db.close();
        };
      }
    }

    $(document).ready(function(e) {
      var indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB || window.shimIndexedDB;

      var open = indexedDB.open("MyDatabase", 1);

      // Create the schema
      open.onupgradeneeded = function() {
        var db = open.result;
        var store = db.createObjectStore("MyObjectStore", { autoIncrement: true });
        var index = store.createIndex("TaskIndex", "task");
      };

      open.onsuccess = function() {
        // Start a new transaction
        var db = open.result;

        var tx = db.transaction("MyObjectStore", "readwrite");
        var store = tx.objectStore("MyObjectStore");

        var request = store.openCursor();

        request.onerror = function(event) {
          console.err("error fetching data");
        };
        request.onsuccess = function(event) {
          let cursor = event.target.result;
          if (cursor) {
            let key = cursor.primaryKey;
            let value = cursor.value;
            console.log(key, value.task);

            var taskItem = "<tr><td><div class='mdc-checkbox'>" +
              "<input type='checkbox' class='mdc-checkbox__native-control' id='" + key + "box'/>" +
              "<div class='mdc-checkbox__background'>" +
              "<svg class='mdc-checkbox__checkmark' viewBox='0 0 24 24'>" +
              "<path class='mdc-checkbox__checkmark-path' " +
              "fill='none'" +
              "stroke='white'" +
              "d='M1.73,12.91 8.1,19.28 22.79,4.59'/>" +
              "</svg>" +
              "<div class='mdc-checkbox__mixedmark'></div>" +
              "</div>" +
              "</div>" +
              "<label for='my-checkbox' id='" + key + "label'>" + value.task + "</label></td></tr>";

            taskNum++;
            console.log(taskItem);
            $("#checkboxTable").append(taskItem);

            cursor.continue();
          }
          else {
            // no more results
          }
        };


        tx.oncomplete = function() {
          db.close();
        }
      }
    })
  </script>
</body>

</html>